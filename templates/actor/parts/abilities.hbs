{{!-- Abilities Tab --}}
<section class="tab abilities{{#if tabs.abilities.active}} active{{/if}}" data-group="primary" data-tab="abilities">

  {{!-- Ability Scores --}}
  <section class="abilities-grid">
    <h3>{{localize "ARIANRHOD.Abilities"}}</h3>
    <div class="ability-list">
      {{#each abilities as |ability key|}}
      <div class="ability flexrow">
        <span class="ability-label" data-action="rollAbility" data-ability="{{key}}"
              title="{{ability.label}} チェック (クリックでロール)">
          {{ability.abbr}}
        </span>
        <button type="button" class="ability-adjust-btn" data-action="decreaseAbility" data-ability="{{key}}"
                title="{{localize 'ARIANRHOD.DecreaseAbility'}}">-</button>
        <input class="ability-value" type="number"
               name="system.abilities.{{key}}.value"
               value="{{ability.value}}" data-dtype="Number" />
        <button type="button" class="ability-adjust-btn" data-action="increaseAbility" data-ability="{{key}}"
                title="{{localize 'ARIANRHOD.IncreaseAbility'}}">+</button>
        {{#if ability.mod}}
        <span class="ability-modifier">+{{ability.mod}}</span>
        <span class="ability-total">={{ability.total}}</span>
        {{/if}}
        <span class="ability-bonus">[{{ability.bonus}}]</span>
      </div>
      {{/each}}
    </div>
  </section>

  {{!-- Combat Stats --}}
  <section class="combat-stats">
    <h3>{{localize "ARIANRHOD.CombatStats"}}</h3>
    <div class="combat-grid">
      <div class="resource hp flexrow">
        <label>{{localize "ARIANRHOD.HP"}}</label>
        <div class="resource-bar-container">
          <div class="resource-bar" style="--bar-pct: {{hpPercent}}%">
            <div class="resource-bar-fill"></div>
          </div>
          <div class="resource-values">
            <input type="number" name="system.combat.hp.value"
                   value="{{system.combat.hp.value}}" data-dtype="Number" />
            <span>/</span>
            <span class="resource-max">{{system.combat.hp.max}}</span>
          </div>
        </div>
      </div>
      <div class="resource mp flexrow">
        <label>{{localize "ARIANRHOD.MP"}}</label>
        <div class="resource-bar-container">
          <div class="resource-bar" style="--bar-pct: {{mpPercent}}%">
            <div class="resource-bar-fill"></div>
          </div>
          <div class="resource-values">
            <input type="number" name="system.combat.mp.value"
                   value="{{system.combat.mp.value}}" data-dtype="Number" />
            <span>/</span>
            <span class="resource-max">{{system.combat.mp.max}}</span>
          </div>
        </div>
      </div>
      <div class="resource fate flexrow">
        <label>{{localize "ARIANRHOD.Fate"}}</label>
        <div class="resource-bar-container">
          <div class="resource-bar" style="--bar-pct: {{fatePercent}}%">
            <div class="resource-bar-fill"></div>
          </div>
          <div class="resource-values">
            <input type="number" name="system.fate.value"
                   value="{{system.fate.value}}" data-dtype="Number" />
            <span>/</span>
            <input type="number" name="system.fate.max"
                   value="{{system.fate.max}}" data-dtype="Number" />
          </div>
        </div>
      </div>
      <div class="combat-detail computed clickable flexrow" data-action="rollAttack"
           title="{{localize 'ARIANRHOD.Accuracy'}}: {{system.combat.accuracyBase}} + {{system.combat.accuracyEquip}}">
        <label>{{localize "ARIANRHOD.Accuracy"}}</label>
        <span class="computed-value">{{system.combat.accuracy}}</span>
        <span class="computed-breakdown">({{system.combat.accuracyBase}}+{{system.combat.accuracyEquip}})</span>
      </div>
      <div class="combat-detail computed clickable flexrow" data-action="rollDamage"
           title="{{localize 'ARIANRHOD.Attack'}}: {{system.combat.attackEquip}}">
        <label>{{localize "ARIANRHOD.Attack"}}</label>
        <span class="computed-value">{{system.combat.attack}}</span>
      </div>
      <div class="combat-detail computed clickable flexrow" data-action="rollEvasion"
           title="{{localize 'ARIANRHOD.Evasion'}}: {{system.combat.evasionEquip}}">
        <label>{{localize "ARIANRHOD.Evasion"}}</label>
        <span class="computed-value">{{system.combat.evasion}}</span>
      </div>
      <div class="combat-detail computed flexrow"
           title="{{localize 'ARIANRHOD.PhysDef'}}: {{system.combat.physDefEquip}}">
        <label>{{localize "ARIANRHOD.PhysDef"}}</label>
        <span class="computed-value">{{system.combat.physDef}}</span>
      </div>
      <div class="combat-detail computed flexrow"
           title="{{localize 'ARIANRHOD.MagDef'}}: {{system.combat.magDefEquip}}">
        <label>{{localize "ARIANRHOD.MagDef"}}</label>
        <span class="computed-value">{{system.combat.magDef}}</span>
      </div>
      <div class="combat-detail computed flexrow"
           title="{{localize 'ARIANRHOD.Initiative'}}: {{system.combat.initiativeBase}} + {{system.combat.initiativeEquip}}">
        <label>{{localize "ARIANRHOD.Initiative"}}</label>
        <span class="computed-value">{{system.combat.initiative}}</span>
        <span class="computed-breakdown">({{system.combat.initiativeBase}}+{{system.combat.initiativeEquip}})</span>
      </div>
      <div class="combat-detail computed flexrow"
           title="{{localize 'ARIANRHOD.Movement'}}: {{system.combat.movementBase}} + {{system.combat.movementEquip}}">
        <label>{{localize "ARIANRHOD.Movement"}}</label>
        <span class="computed-value">{{system.combat.movement}}</span>
        <span class="computed-breakdown">({{system.combat.movementBase}}+{{system.combat.movementEquip}})</span>
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.MagAttack"}}</label>
        <input type="number" name="system.combat.magAttack"
               value="{{system.combat.magAttack}}" data-dtype="Number" />
      </div>
    </div>
  </section>

  {{!-- Status Effects --}}
  <section class="status-effects">
    <h3>{{localize "ARIANRHOD.StatusEffects"}}</h3>
    <div class="status-effects-grid">
      {{#each statusEffects as |effect|}}
      <div class="status-badge {{effect.id}}" data-action="toggleStatus" data-status-id="{{effect.id}}" title="{{effect.label}}">
        <img src="{{effect.icon}}" width="24" height="24" />
        <span class="status-label">{{effect.label}}</span>
      </div>
      {{/each}}
      {{#unless statusEffects.length}}
      <span class="no-status">{{localize "ARIANRHOD.NoStatusEffects"}}</span>
      {{/unless}}
    </div>
    <div class="status-add">
      <select data-action="addStatusEffect">
        <option value="">{{localize "ARIANRHOD.AddStatusEffect"}}...</option>
        {{#each availableStatuses as |status|}}
        <option value="{{status.id}}">{{status.label}}</option>
        {{/each}}
      </select>
    </div>
  </section>

  {{!-- Special Checks --}}
  <section class="special-checks">
    <h3>{{localize "ARIANRHOD.SpecialChecks"}}</h3>
    <div class="special-checks-grid">
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckAlchemy"}}</label>
        <input type="number" name="system.specialChecks.alchemy"
               value="{{system.specialChecks.alchemy}}" data-dtype="Number" />
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckTrapDisarm"}}</label>
        <input type="number" name="system.specialChecks.trapDisarm"
               value="{{system.specialChecks.trapDisarm}}" data-dtype="Number" />
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckTrapDetect"}}</label>
        <input type="number" name="system.specialChecks.trapDetect"
               value="{{system.specialChecks.trapDetect}}" data-dtype="Number" />
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckDangerSense"}}</label>
        <input type="number" name="system.specialChecks.dangerSense"
               value="{{system.specialChecks.dangerSense}}" data-dtype="Number" />
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckMagic"}}</label>
        <input type="number" name="system.specialChecks.magicCheck"
               value="{{system.specialChecks.magicCheck}}" data-dtype="Number" />
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckEnemyIdentify"}}</label>
        <input type="number" name="system.specialChecks.enemyIdentify"
               value="{{system.specialChecks.enemyIdentify}}" data-dtype="Number" />
      </div>
      <div class="combat-detail flexrow">
        <label>{{localize "ARIANRHOD.CheckItemAppraise"}}</label>
        <input type="number" name="system.specialChecks.itemAppraise"
               value="{{system.specialChecks.itemAppraise}}" data-dtype="Number" />
      </div>
    </div>
  </section>

  {{!-- Currency & Carrying --}}
  <section class="currency-carry-section">
    <div class="currency-section flexrow">
      <label>{{localize "ARIANRHOD.Currency"}}</label>
      <input type="number" name="system.currency"
             value="{{system.currency}}" data-dtype="Number" />
      <span class="currency-unit">{{localize "ARIANRHOD.CurrencyUnit"}}</span>
    </div>
    <div class="carry-section flexrow">
      <label>{{localize "ARIANRHOD.CarryCapacity"}}</label>
      <div class="resource-values">
        <input type="number" name="system.carryCapacity.value"
               value="{{system.carryCapacity.value}}" data-dtype="Number" />
        <span>/</span>
        <input type="number" name="system.carryCapacity.max"
               value="{{system.carryCapacity.max}}" data-dtype="Number" />
      </div>
    </div>
  </section>

</section>
