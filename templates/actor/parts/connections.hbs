{{!-- Connections Tab --}}
<section class="tab connections {{tab.cssClass}}" data-group="primary" data-tab="connections">

  {{!-- Connections --}}
  <section class="connections-section">
    <div class="item-section-header flexrow">
      <h3><i class="fas fa-handshake"></i> {{localize "ARIANRHOD.Connections"}}</h3>
      <a data-action="addConnection" title="{{localize 'ARIANRHOD.Add'}}">
        <i class="fas fa-plus"></i>
      </a>
    </div>
    {{#if system.connections.length}}
    <div class="connections-cards">
      {{#each system.connections as |conn idx|}}
      <div class="connection-card" data-conn-index="{{idx}}">
        <div class="conn-card-header">
          <div class="conn-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="conn-card-name">
            <input type="text" name="system.connections.{{idx}}.name" value="{{conn.name}}"
                   placeholder="{{localize 'ARIANRHOD.ConnectionName'}}" />
          </div>
          <a class="conn-delete" data-action="deleteConnection" data-index="{{idx}}" title="{{localize 'ARIANRHOD.ItemDelete'}}">
            <i class="fas fa-times"></i>
          </a>
        </div>
        <div class="conn-card-body">
          <div class="conn-field conn-field-relation">
            <label><i class="fas fa-heart"></i></label>
            <select name="system.connections.{{idx}}.relation">
              <option value="">— {{localize "ARIANRHOD.ConnectionRelation"}} —</option>
              {{#each @root.connectionRelations as |label key|}}
              <option value="{{key}}" {{#if (eq key conn.relation)}}selected{{/if}}>{{localize label}}</option>
              {{/each}}
            </select>
            <a class="conn-roll-relation" data-action="rollRelation" data-index="{{idx}}" title="{{localize 'ARIANRHOD.RollRelation'}}">
              <i class="fas fa-dice"></i>
            </a>
          </div>
          <div class="conn-field">
            <label><i class="fas fa-map-marker-alt"></i></label>
            <input type="text" name="system.connections.{{idx}}.place" value="{{conn.place}}"
                   placeholder="{{localize 'ARIANRHOD.ConnectionPlace'}}" />
          </div>
          <div class="conn-field conn-field-wide">
            <label><i class="fas fa-info-circle"></i></label>
            <input type="text" name="system.connections.{{idx}}.info" value="{{conn.info}}"
                   placeholder="{{localize 'ARIANRHOD.ConnectionInfo'}}" />
          </div>
          <div class="conn-bonuses">
            <span class="conn-bonus-tag" title="{{localize 'ARIANRHOD.ConnectionAppearance'}}"><i class="fas fa-door-open"></i> +1D</span>
            <span class="conn-bonus-tag" title="{{localize 'ARIANRHOD.ConnectionInfoGather'}}"><i class="fas fa-search"></i> +2</span>
          </div>
        </div>
      </div>
      {{/each}}
    </div>
    {{else}}
    <div class="connections-empty">
      <i class="fas fa-users"></i>
      <p>{{localize "ARIANRHOD.NoConnections"}}</p>
    </div>
    {{/if}}
  </section>

  {{!-- Growth Log --}}
  <section class="growth-log-section">
    <div class="item-section-header flexrow">
      <h3><i class="fas fa-chart-line"></i> {{localize "ARIANRHOD.GrowthLog"}}</h3>
      <div class="growth-summary">
        <span class="growth-points-badge" title="{{localize 'ARIANRHOD.GrowthPoints'}}">
          <i class="fas fa-seedling"></i>
          {{system.growthPoints.remaining}} / {{system.growthPoints.total}}
        </span>
      </div>
      <a data-action="addGrowthLog" title="{{localize 'ARIANRHOD.Add'}}">
        <i class="fas fa-plus"></i>
      </a>
    </div>
    {{#if system.growthLog.length}}
    <div class="growth-timeline">
      {{#each system.growthLog as |entry idx|}}
      <div class="growth-entry" data-growth-index="{{idx}}">
        <div class="growth-entry-marker">
          <span class="growth-level-badge">Lv.
            <input type="number" name="system.growthLog.{{idx}}.level" value="{{entry.level}}" data-dtype="Number" />
          </span>
        </div>
        <div class="growth-entry-content">
          <div class="growth-entry-row">
            <div class="growth-field">
              <label>{{localize "ARIANRHOD.Abilities"}}</label>
              <input type="text" name="system.growthLog.{{idx}}.abilities" value="{{entry.abilities}}"
                     placeholder="STR+1, DEX+1..." />
            </div>
            <div class="growth-field">
              <label>{{localize "ARIANRHOD.Skill"}}</label>
              <input type="text" name="system.growthLog.{{idx}}.skills" value="{{entry.skills}}"
                     placeholder="{{localize 'ARIANRHOD.Skill'}}..." />
            </div>
          </div>
          <div class="growth-entry-row">
            <div class="growth-field growth-field-sm">
              <label>GP</label>
              <input type="number" name="system.growthLog.{{idx}}.growthPts" value="{{entry.growthPts}}" data-dtype="Number" />
            </div>
            <div class="growth-field growth-field-sm">
              <label><i class="fas fa-coins"></i></label>
              <input type="number" name="system.growthLog.{{idx}}.gold" value="{{entry.gold}}" data-dtype="Number" />
            </div>
            <div class="growth-field">
              <label>{{localize "ARIANRHOD.Notes"}}</label>
              <input type="text" name="system.growthLog.{{idx}}.notes" value="{{entry.notes}}" />
            </div>
          </div>
        </div>
        <a class="growth-delete" data-action="deleteGrowthLog" data-index="{{idx}}" title="{{localize 'ARIANRHOD.ItemDelete'}}">
          <i class="fas fa-times"></i>
        </a>
      </div>
      {{/each}}
    </div>
    {{else}}
    <div class="growth-empty">
      <i class="fas fa-seedling"></i>
      <p>{{localize "ARIANRHOD.NoGrowthLog"}}</p>
    </div>
    {{/if}}
  </section>

</section>
