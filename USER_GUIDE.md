# 아리안로드 RPG 2E — Foundry VTT 시스템 사용 가이드

> **시스템 버전**: 0.4.0 | **호환 FVTT**: v13+ | **언어**: 한국어 / 日本語 / English

---

## 목차

1. [개요 & 빠른 시작](#1-개요--빠른-시작)
2. [캐릭터 시트](#2-캐릭터-시트)
3. [에너미 시트 & 라이브러리](#3-에너미-시트--라이브러리)
4. [길드 시트](#4-길드-시트)
5. [전투 시스템](#5-전투-시스템)
6. [주사위 시스템](#6-주사위-시스템)
7. [매크로 & 핫바](#7-매크로--핫바)
8. [GM 도구](#8-gm-도구)
9. [기능 검증 체크리스트](#9-기능-검증-체크리스트)
10. [미구현 기능 & 로드맵](#10-미구현-기능--로드맵)

---

## 1. 개요 & 빠른 시작

### 시스템 소개

아리안로드 RPG 2E(F.E.A.R. 제작)의 Foundry VTT 구현입니다. JRPG 스타일의 판타지 TRPG로, 2D6 기반 판정 시스템과 전략적 엔게이지먼트 전투를 지원합니다.

### 첫 로딩

GM이 월드에 처음 접속하면 **컴펜디움 팩이 자동 생성**됩니다:

| 컴펜디움 | 내용 | 수량 |
|----------|------|------|
| Skills / スキル | PC 스킬 라이브러리 | 330개 |
| Equipment / 装備 | 무기·방어구·장신구·아이템 | 전체 장비 |
| Enemy Skills / エネミースキル | 에너미 전용 스킬 | 전체 에너미 스킬 |

> 자동 생성은 최초 1회만 실행됩니다. 이후엔 건너뜁니다.

### 시스템 설정 (7가지)

**설정 > 시스템 설정** 에서 다음을 조정할 수 있습니다:

| 설정 | 기본값 | 설명 |
|------|--------|------|
| **크리티컬 범위** | 6이 2개 이상 | 6이 1개로 완화 가능 (하우스룰) |
| **페이트 사용** | ON | 판정 시 페이트 다이스 허용 여부 |
| **자동 데미지 계산** | ON | 대상 토큰의 방어력을 자동 차감 |
| **HP 0 자동 전투불능** | ON | HP가 0이 되면 자동 알림 |
| **이니셔티브 방식** | 고정 (행동값) | "롤 (2D6+행동값)"으로 변경 가능 |
| **행동 경제 시스템** | ON | M/m/Mv/R 액션 추적 활성화 |
| **엔게이지먼트 시스템** | ON | 근접 전투 엔게이지먼트 검증 |

### 액터 타입 3종

| 타입 | 설명 |
|------|------|
| `character` | PC (플레이어 캐릭터) |
| `enemy` | 에너미 (적) |
| `guild` | 길드 |

### 아이템 타입 6종

| 타입 | 설명 |
|------|------|
| `weapon` | 무기 |
| `armor` | 방어구 |
| `accessory` | 장신구 |
| `skill` | 스킬 |
| `item` | 일반 아이템 (포션, 도구 등) |
| `trap` | 함정 |

---

## 2. 캐릭터 시트

### 2.1 기본 정보

시트 상단에서 다음을 설정합니다:

- **이름** / **이미지**
- **종족** (9종): 휴린, 엘다난, 네바프, 필보르, 버나, 두앙, 엑스마키나, 드래고넷, 어션
- **메인 클래스** (4종): 워리어, 어콜라이트, 메이지, 시프
- **서포트 클래스** (14종): 위 4종 + 건슬링거, 닌자, 댄서, 레인저, 몽크, 바드, 사무라이, 서머너, 세이지, 알케미스트
- **레벨** / **경험치** / **소지금**

> 종족/클래스를 선택하면 능력치 보정과 HP/MP가 자동 계산됩니다.

### 2.2 능력치 탭

7개 능력치와 보너스가 표시됩니다:

| 능력치 | 약어 | 설명 |
|--------|------|------|
| 근력 | STR | 물리 공격, 투척 사거리 |
| 기민 | DEX | 명중, 물리방어 |
| 민첩 | AGI | 회피, 행동력 |
| 지력 | INT | 마법 공격, 마법방어 |
| 감각 | SEN | 함정 탐지, 위험 감지 |
| 정신 | MEN | 정신 저항 |
| 행운 | LUK | 페이트 다이스 상한 |

**보너스** = `능력치 ÷ 3` (소수점 버림)

#### 능력치 판정

각 능력치 옆의 **주사위 버튼**을 클릭하면 `2D6 + 보너스` 판정을 굴립니다.

#### 특수 판정 (7종)

시트 하단 또는 우클릭 메뉴에서 사용 가능:

| 판정 | 사용 능력치 |
|------|-------------|
| 연금술 판정 | INT |
| 함정 해제 | DEX |
| 함정 탐지 | SEN |
| 위험 감지 | SEN |
| 마술 판정 | INT |
| 적 식별 | INT |
| 아이템 감정 | INT |

### 2.3 전투 스탯

장비를 기반으로 자동 계산되는 전투 스탯:

| 스탯 | 계산 방식 |
|------|-----------|
| **HP** | 클래스 기본 + (레벨 × 성장치) |
| **MP** | 클래스 기본 + (레벨 × 성장치) |
| **명중** | DEX 보너스 + 무기 보정 |
| **회피** | AGI 보너스 + 방어구 보정 |
| **공격력** | STR 보너스 + 무기 공격력 |
| **물리방어력** | DEX 보너스 + 방어구 합 |
| **마법방어력** | INT 보너스 + 장비 보정 |
| **행동력** | AGI 보너스 + 장비 보정 |
| **이동력** | 기본 3 + 장비/스킬 보정 |

### 2.4 장비 탭 (6슬롯)

| 슬롯 | 설명 |
|------|------|
| 오른손 | 무기 또는 방패 |
| 왼손 | 무기 또는 방패 |
| 머리 | 투구류 |
| 몸통 | 갑옷류 |
| 장신구1 | 악세서리 |
| 장신구2 | 악세서리 |

**장비 방법**:
1. 장비 탭에서 **+** 버튼 클릭 → 장비 선택 다이얼로그 오픈
2. 카테고리/검색으로 장비 필터링
3. 원하는 장비의 **추가** 버튼 클릭
4. 슬롯에 드래그하여 장착
5. 장착된 장비 클릭 → 장착/해제 토글

**장비 선택 다이얼로그**: 무기·방어구·장신구·일반 아이템 탭 전환, 카테고리 필터, 텍스트 검색, 커스텀 장비 생성 지원

#### 클래스 제한

일부 장비에는 **클래스 제한**이 있습니다:

| 제한 코드 | 사용 가능 클래스 |
|-----------|-----------------|
| (없음) | 제한 없음 |
| W | 워리어만 |
| A | 어콜라이트만 |
| M | 메이지만 |
| T | 시프만 |
| WA | 워리어/어콜라이트 |
| WM | 워리어/메이지 |
| WT | 워리어/시프 |
| AM | 어콜라이트/메이지 |
| WAM | 워리어/어콜라이트/메이지 |
| (기타) | 조합에 따라 다름 |

> 장비 아이템 시트에서 **클래스 제한**, **마법 무기 여부**, **감정 난이도** 등을 확인할 수 있습니다.

#### 소지 용량

시트 하단에 **소지 용량** 정보가 표시됩니다:
- **총 아이템**: 소지한 아이템 총 수
- **총 중량**: 소지한 아이템 총 무게
- **총 가치**: 소지한 아이템 총 가격

### 2.5 스킬 탭

#### 스킬 라이브러리 (330개)

1. **+** 버튼 클릭 → 스킬 선택 다이얼로그 오픈
2. 필터 옵션:
   - **모든 스킬**: 전체 표시
   - **메인 클래스만**: 메인 클래스 스킬만
   - **서포트 클래스만**: 서포트 클래스 스킬만
   - **일반 스킬**: 범용 스킬
   - **클래스로 필터**: 특정 클래스 선택
3. **검색**: 스킬명으로 실시간 검색
4. **선택** 버튼으로 취득

#### 스킬 발동

- 취득한 스킬의 **발동** 버튼 클릭
- MP 코스트가 자동 차감 (부족 시 경고)
- 패시브 스킬은 자동 효과 (발동 불요)
- 스킬 레벨(SL) 증감: ▲/▼ 버튼

#### 스킬 타이밍

| 타이밍 | 설명 |
|--------|------|
| 패시브 | 상시 효과 |
| 셋업 | 라운드 시작 시 |
| 이니셔티브 | 이니셔티브 페이즈 |
| 마이너 | 마이너 액션 |
| 무브 | 무브 액션 |
| 메이저 | 메이저 액션 |
| 프리 | 프리 액션 |
| 리액션 | 리액션 |
| 판정 | 판정 시 |
| 데미지 | 데미지 판정 시 |
| 데미지 적용 후 | 데미지 적용 후 |
| 클린업 | 클린업 페이즈 |
| 아이템 | 아이템 사용 시 |
| 상시 | 항상 |

### 2.6 커넥션 & 성장 탭

#### 커넥션

- **+** 버튼으로 커넥션 추가
- 이름, 관계, 장소, 정보 입력
- **관계 D66 롤** 버튼: 2D6로 D66 테이블에서 관계 자동 결정
- 18종 관계: 주종, 친구, 동지, 동경, 빚, 거래, 신뢰, 비호, 동행자, 악연, 혈연, 후원자, 은인, 데자뷰, 은혜, 호적수, 보호자, 그리움
- **커넥션 보너스**: 등장 판정 +1D, 정보 수집 +2

#### 성장 로그

- **+** 버튼으로 기록 추가
- 레벨 올리기/내리기 버튼
- 성장점 소모로 능력치 증가 (+1 능력치당 1 성장점)
- 능력치 감소로 성장점 환불

### 2.7 라이프 패스

프로필 영역에서 라이프 패스를 설정합니다:

- **출신**: D66 롤 또는 직접 선택 (20종)
- **경위**: D66 롤 또는 직접 선택 (18종)
- **목적**: D66 롤 또는 직접 선택 (18종)

각 항목 옆의 **2D6 롤** 버튼으로 무작위 결정 가능

### 2.8 페이트 포인트

- 시트 상단에 현재 페이트 / 최대 페이트 표시
- 판정 시 **페이트 다이스** 추가 가능
- 페이트 다이스 상한 = `min(현재 페이트, LUK 보너스)`
- 페이트 1개 = +1D6 추가
- 판정 후 **재굴림** 버튼 (페이트 1 소비)

### 2.9 캐릭터 내보내기 / 가져오기

- **내보내기**: 시트 헤더의 내보내기 버튼 → JSON 파일 다운로드
- **가져오기**: 시트 헤더의 가져오기 버튼 → JSON 파일 선택
- 버전 불일치 시 경고 표시
- 다른 월드 간 캐릭터 이동에 유용

---

## 3. 에너미 시트 & 라이브러리

### 3.1 에너미 생성 다이얼로그

**액터 생성 시 에너미 타입을 선택**하면 에너미 생성 다이얼로그가 열립니다.

#### 라이브러리에서 생성

- **41종 에너미** 데이터 수록 (완전 데이터 17종 + 이름만 24종)
- 3가지 필터:
  - **카테고리**: 전체 / 몹 / 솔로
  - **타입**: 요마, 언데드, 동물, 요정, 인간, 인조생물, 식물, 기계
  - **레벨**: 레벨별 필터
- **검색**: 이름으로 실시간 검색 (한/영/일 모두 지원)
- **미리보기**: 에너미를 선택하면 우측에 스탯 미리보기 표시
- **라이브러리에서 생성** 버튼: 선택한 에너미의 스탯이 자동 입력

#### 커스텀 생성

- **커스텀 생성** 버튼: 빈 에너미 시트 생성 후 직접 입력

### 3.2 에너미 시트

에너미 시트에서 설정하는 항목:

- **기본 정보**: 이름, 이미지, 레벨, 타입 (잡몹/보스/네임드), 경험치
- **전투 스탯**: HP, MP, 명중, 회피, 공격력, 물리방어, 마법방어, 행동력, 이동력
- **속성**: 본질 속성 (무/화/수/풍/지/광/암)
- **공격 패턴**: 공격 방식 설명 텍스트
- **드롭 아이템**: "6~8: 아이템명(가격) / 9~12: 아이템명(가격)" 형식
  - 에너미 격파 시 자동 2D6 롤로 드롭 결정
- **태그**: 분류용 태그

### 3.3 에너미 스킬

- 에너미 시트의 스킬 영역에서 **+** 버튼 → 에너미 스킬 선택 다이얼로그
- 텍스트 검색으로 필터링
- 이미 취득한 스킬은 자동 표시
- 스킬 레벨(SL) 조정 가능

---

## 4. 길드 시트

### 길드 생성

액터 생성 시 "guild" 타입을 선택합니다.

### 길드 시트 구성

| 항목 | 설명 |
|------|------|
| **길드 이름** | 길드명 |
| **길드 레벨** | 1~5 (▲/▼ 버튼) |
| **길드 자금** | 공유 자금 |
| **길드 멤버** | 멤버 목록 (이름, 역할) |
| **길드 서포트** | 취득한 길드 서포트 목록 |

### 길드 서포트

- **+** 버튼 → 길드 서포트 선택 다이얼로그
- 길드 레벨에 따라 슬롯 수 제한
- 중복 취득 불가 (설정에 따라 허용되는 서포트 제외)
- 각 서포트는 사용 조건과 효과 표시

---

## 5. 전투 시스템

### 5.1 전투 시작

#### 퀵 전투 시작 (권장)

1. 씬에 PC 토큰과 에너미 토큰을 배치
2. PC 토큰을 클릭하여 선택
3. 에너미 토큰을 **Shift+클릭**으로 타겟팅 (여러 명 가능)
4. 토큰 HUD의 **전투 시작** 버튼 클릭
5. 선택/타겟된 모든 토큰이 자동으로 전투에 추가
6. 이니셔티브 자동 롤 → 전투 개시

> 전투 중 추가 토큰은 토큰 HUD의 **전투 참가** 버튼으로 합류

#### 전투 시작 시 채팅에 표시되는 가이드:
1. 토큰 클릭 → HUD에서 **명중 판정** / **회피 판정**
2. 채팅의 **데미지 롤** 버튼으로 데미지 계산
3. **데미지 적용** 버튼으로 대상에게 적용
4. 행동(M), 보조(m), 이동(Mv)은 턴당 1회씩 사용 가능

#### 이니셔티브

| 방식 | 공식 | 설정 |
|------|------|------|
| 고정 (기본) | 행동값 | 장비/스킬로 결정 |
| 롤 | 2D6 + 행동값 | 시스템 설정에서 변경 |

### 5.2 행동 경제 (액션 트래커)

턴당 사용 가능한 액션:

| 액션 | 약어 | 횟수 | 용도 |
|------|------|------|------|
| **메이저 액션** | M | 1회 | 공격, 스킬 발동 |
| **마이너 액션** | m | 1회 | 장비 변경, 스킬, 기승/하마 |
| **무브 액션** | Mv | 1회 | 이동 (전투/전력/이탈/돌입) |
| **프리 액션** | - | 1회 | 최후의 일격 선언 등 |
| **리액션** | R | 1회 | 회피 판정 |

**토큰 HUD 트래커**: 전투 중 토큰 클릭 시 `M m Mv R` 아이콘이 표시되며, 사용한 액션은 회색으로 변합니다.

#### 액션 제약

- **전력이동 / 이탈** 후 → 마이너 액션 사용 불가
- **마이너 액션** 사용 후 → 전력이동 / 이탈 불가
- **위압** 상태 → 메이저 액션 불가
- **수면 / 석화** → 메이저 & 마이너 불가
- **마비 / 석화 / 슬립** → 이동 불가
- **전투불능** (HP=0) → 모든 행동 불가

### 5.3 공격 플로우 (7단계 완전 가이드)

#### Step 1: 대상 타겟팅

- 공격할 에너미 토큰을 **클릭** (타겟팅)
- 범위 공격: **Shift+클릭**으로 여러 대상 선택

#### Step 2: 공격 판정 (명중 판정)

**방법 A** — 내 토큰 HUD:
- 내 토큰 클릭 → HUD의 **명중 판정** 버튼

**방법 B** — 대상 토큰 HUD:
- 대상 토큰 클릭 → HUD의 **{이름} 공격!** 버튼 (현재 턴 캐릭터가 자동으로 공격)

**판정 다이얼로그**:
- 수정치 (기본: 명중 보너스, 편집 가능)
- 페이트 다이스 (0 ~ LUK 보너스, 페이트 소비)
- 상태이상 패널티 자동 표시 (방심 -1D, 격노 -2D)

**결과 → 채팅 공격 카드**:
- 무기명 & 이미지
- 판정 결과 (합계, 크리티컬/펌블 표시)
- 대상별 **회피 판정** 버튼
- **데미지 롤** 버튼
- **페이트 재굴림** 버튼 (페이트 1 추가 소비)

> **무기 복수 장착**: 양손에 무기 장착 시 무기 선택 다이얼로그 표시

#### Step 3: 회피 판정

- 채팅 공격 카드의 대상 이름 옆 **회피 판정** 버튼 클릭
- 대상 플레이어 (또는 GM)이 회피 다이얼로그 입력
- 수정치 (기본: 회피 보너스)
- 페이트 다이스 사용 가능
- 상태이상 패널티: 기절 -1D, 기습 -1D (경계 스킬로 무효화 가능)

#### Step 4: 명중 판정 (자동)

회피 판정 후 **명중 결과 카드**가 자동 생성:
- 공격 달성치 vs 회피 달성치 비교
- **리액션측 우선**: 동일 달성치 시 방어측 승리
- **양측 크리티컬**: 방어측 승리
- **공격 펌블**: 달성치 0 → 자동 실패
- **회피 펌블**: 달성치 0 → 자동 명중

결과: **명중** 시 데미지 롤 버튼 표시

#### Step 5: 데미지 판정

명중 시 채팅 카드의 **데미지 롤** 버튼 클릭:

| 공식 | 계산 |
|------|------|
| 기본 | 2D6 + 무기 공격력 |
| 크리티컬 | 2D6 + 무기 공격력 + (6이 나온 개수)D6 |
| 관통 | 방어력 무시 |

**데미지 카드**에 표시되는 정보:
- 무기명 & 속성 배지 (화/수/풍/지/광/암)
- 원시 데미지
- 대상의 방어력 (물리방어 또는 마법방어)
- 속성 상성 (강화 ×2 / 약점 ×0)
- **최종 데미지** = 원시 - 방어력 (최소 0)
- **데미지 적용** 버튼
- **커버** 버튼 (조건 충족 시)

#### Step 6: 데미지 적용

- **데미지 적용** 버튼 클릭 → 대상 HP에서 최종 데미지 차감
- HP가 0이 되면 **전투불능** 알림
- 에너미 격파 시 **드롭 아이템** 자동 롤

#### Step 7: 커버

- 같은 엔게이지먼트에 아군이 있으면 **커버** 버튼 활성화
- 클릭 → 커버할 아군 선택 다이얼로그
- 선택한 아군이 대신 피격 (아군의 물리방어로 재계산)

### 5.4 마법 공격

- 토큰 HUD의 **마법 명중 판정** 버튼
- 명중 판정: `2D6 + INT 보너스` (에너미는 명중 보너스 사용)
- 데미지: `2D6 + 마법공격력`
- 속성 있는 무기의 데미지 → 대상의 **마법방어력** 사용

**속성 상성** (6속성):

| 관계 | 속성쌍 | 방어 배수 |
|------|--------|-----------|
| 대립 | 화↔수, 풍↔지, 광↔암 | ×0 (약점) |
| 동일 | 같은 속성 | ×2 (강화) |
| 기타 | 해당 없음 | ×1 (일반) |

### 5.5 다중 대상 범위 공격

1. **Shift+클릭**으로 여러 에너미 토큰 타겟
2. 명중 판정 → 채팅 카드에 대상별 회피 버튼 표시
3. 각 대상이 개별적으로 회피 판정
4. 명중한 대상에게만 데미지 적용

### 5.6 이동 시스템

전투 중 토큰 HUD에 이동 버튼이 표시됩니다:

| 이동 타입 | 거리 | 제약 |
|-----------|------|------|
| **전투이동** | 이동력 m | 마이너 액션 사용 가능 |
| **전력이동** | 이동력 ×2 m | 마이너 액션 불가 |
| **이탈** | min(5, 이동력) m | 마이너 불가, 봉쇄 판정 발생 |
| **돌입** | 이동력 m | 엔게이지 미참가 시만, 대상 선택 |

#### 기승 상태의 이동

기승 중에는 **탑승물의 이동력**을 사용합니다.

#### 비행 상태의 이동

비행(飛行) 상태의 캐릭터는:
- 엔게이지 상태여도 **이탈 없이** 자유 이동 가능
- 전투이동/전력이동 시 엔게이지에서 자동 이탈

### 5.7 봉쇄

**이탈** 시도 시 같은 엔게이지의 적이 **봉쇄**를 시도할 수 있습니다:

1. 이탈 시도 → GM에게 봉쇄 다이얼로그 표시
2. 봉쇄할 캐릭터 선택 (체크박스)
3. **대항 판정**: 이탈자 `2D6 + 행동값` vs 봉쇄자 `2D6 + 행동값`
4. 이탈자 우선: 동점 시 이탈자 승리
5. 봉쇄자 중 하나라도 성공 → 이탈 실패 (무브 액션은 소비됨)
6. 채팅에 봉쇄 결과 표시

### 5.8 엔게이지먼트

**엔게이지먼트**: 근접 전투 범위에 있는 캐릭터들의 그룹

#### 자동 관리

- 근접 공격 시 공격자와 대상이 **자동 엔게이지** 생성
- 돌입 시 대상과 엔게이지 자동 생성
- 이탈 성공 시 엔게이지에서 자동 제거
- 전투 종료 시 모든 엔게이지 초기화

#### 엔게이지 규칙

- **근접 공격**: 같은 엔게이지 필수 (미 엔게이지 시 경고)
- **사격 공격**: 같은 엔게이지 내 대상 공격 불가 (경고)
- 토큰 HUD에 엔게이지 상태 배지 표시 (상대 이름 포함)

#### 수동 관리

GM 콘솔이나 매크로에서:
```javascript
// 엔게이지 생성
game.arianrhod2e.combat.createEngagement(game.combat, combatantId1, combatantId2);
// 엔게이지 해제
game.arianrhod2e.combat.removeFromEngagement(game.combat, combatantId);
// 엔게이지 목록 조회
game.arianrhod2e.combat.getEngagements(game.combat);
```

### 5.9 기승 / 하마

- 마이너 액션으로 탑승물에 기승 / 하마
- 기승 중 이동력 = 탑승물의 이동력 사용

```javascript
// 기승
actor.mountRide(mountActor);
// 하마
actor.dismount();
```

### 5.10 상태이상 & 배드 스테이터스

#### 상태이상 13종

| 상태이상 | 효과 | 아이콘 |
|----------|------|--------|
| **독** | 클린업 시 5×n HP 감소 | poison |
| **기절** | 리액션 -1D, 이니셔티브 시 회복 | stun |
| **수면** | 행동 불가, 데미지로 해제 | sleep |
| **마비** | 이동 불가 | paralysis |
| **석화** | 행동 & 이동 불가 | petrification |
| **공포** | (효과 참조) | fear |
| **매료** | (효과 참조) | charm |
| **빙결** | (효과 참조) | frozen |
| **맹목** | (효과 참조) | blind |
| **전도** | (효과 참조) | prone |
| **비행** | 엔게이지 자유 이탈, 지상 효과 무시 | flight |
| **투명** | 타겟팅 불가, 공격 시 해제 | invisible |
| **은신** | 발각 시 해제, 공격/데미지로 자동 해제 | hidden |

> **은신 vs 투명**: 은신은 적이 감지하지 못하는 상태이며, 공격이나 데미지를 줄 때 자동 해제됩니다. 투명은 마법적으로 보이지 않는 상태입니다.

#### 배드 스테이터스 7종

| 배드 스테이터스 | 효과 | 회복 시점 |
|----------------|------|-----------|
| **격노** | 판정 -2D | 클린업 자동 회복 |
| **방심** | 메이저 판정 -1D | 클린업 자동 회복 |
| **위압** | 메이저 액션 불가 | 마이너 액션으로 수동 회복 |
| **넉백(n)** | 행동값 -5n | 클린업 자동 회복 |
| **슬립** | 이동 불가 | 무브 액션으로 수동 회복 |
| **어둠** | (환경 효과) | - |

#### 라운드 진행 시 자동 처리

| 페이즈 | 자동 처리 |
|--------|-----------|
| **이니셔티브** | 기절 회복 |
| **메인 (턴 시작)** | 액션 초기화, 넉백/방심 경고 |
| **클린업** | 독 데미지, 격노/방심/넉백 회복 |
| **전투 종료** | 전투불능(HP=0) → HP 1 회복, 쿠드그라스 플래그 초기화 |

### 5.11 특수 규칙

#### 관통 데미지

- 방어력을 완전히 무시하는 데미지
- 환경 데미지 (추락, 화염 등)에 적용
- `game.arianrhod2e.combat` 없이 GM이 매크로로 적용

#### 쿠드그라스 (최후의 일격)

**전투불능** (HP=0)인 대상을 완전히 **사망**시키는 특수 규칙입니다.

1. 대상이 **전투불능** (HP=0) 상태인지 확인
2. **프리 액션**으로 최후의 일격 **선언** → 채팅에 해골 아이콘과 함께 표시
3. 이후 **메이저 액션**으로 데미지를 가하면 대상이 **사망** 처리

> 전투불능과 사망의 차이: 전투불능 캐릭터는 전투 종료 시 HP 1로 회복되지만, 사망한 캐릭터는 회복되지 않습니다.

```javascript
// 최후의 일격 선언 (대상 액터에서)
targetActor.declareCoupDeGrace();
```

#### 기습

- 라운드 1에서만 적용
- 기습당한 측의 리액션 (회피) -1D
- **경계** 스킬 보유 시 기습 패널티 무효화

```javascript
// 기습 설정 (GM)
import { setSurprise } from "./module/helpers/combat-manager.mjs";
await setSurprise(game.combat, "pcs");     // PC 측 기습
await setSurprise(game.combat, "enemies"); // 에너미 측 기습
await setSurprise(game.combat, null);      // 해제
```

#### 투척 무기

- 사거리 = STR 보너스 + 5m

#### 셋업 페이즈

- 매 라운드 시작 시 셋업 타이밍 스킬 보유자 자동 표시
- 채팅에 스킬 목록 공지

---

## 6. 주사위 시스템

### 기본 판정

`2D6 + 수정치`

### 크리티컬 & 펌블

| 조건 | 판정 |
|------|------|
| **크리티컬** | 6이 2개 이상 (설정에 따라 1개도 가능) |
| **펌블** | 모든 주사위가 1 (페이트 미사용 시만) |

### 페이트 다이스

- 판정 시 다이얼로그에서 페이트 다이스 수 입력
- 상한 = `min(현재 페이트, LUK 보너스)`
- 페이트 1개 = +1D6 추가
- 페이트 다이스가 포함된 판정은 **펌블 불가** (모든 주사위가 1이어야 하므로)

### 페이트 재판정

- 공격 판정 후 채팅 카드의 **재굴림** 버튼
- 페이트 1 소비
- 같은 공식으로 다시 롤
- 1회만 가능 (재굴림 결과에는 재굴림 버튼 없음)

### D66 테이블

- 라이프 패스 결정에 사용
- 2D6: 첫째 주사위 = 10의 자리, 둘째 = 1의 자리
- 11~66까지 36가지 결과

### FS 판정 (Favorable Situation)

FS 판정은 **장기 판정**으로, 전투나 탐색에서 달성도를 누적하여 목표치에 도달하는 시스템입니다.

**사용 예시**: 추격전, 퍼즐 해결, 성 공략 등

**매크로로 FS 판정 실행**:
```javascript
const result = await game.arianrhod2e.rollFSCheck({
  modifier: 5,          // 능력 수정치
  difficulty: 11,       // 목표 난이도
  fateDice: 0,          // 페이트 다이스
  label: "추격전",      // 판정명
  currentProgress: 3,   // 현재 달성도
  completionTarget: 10, // 목표 달성도
  actor: myActor,       // 판정 주체
});
```

채팅에 **달성도 변화** + **프로그레스 바** 표시, 목표 도달 시 "FS 달성!" 알림

| 달성치 - 난이도 | 결과 | 달성도 |
|----------------|------|--------|
| +6 이상 | 대 성공 | +4 |
| +5 | 성공 | +3 |
| +3~+4 | 좋은 성과 | +2 |
| +1~+2 | 여유 있는 성공 | +1 |
| 0 | 아슬아슬 | +1 |
| -1 | 아깝게 실패 | 0 |
| -2 | 조금 부족 | 0 |
| -3~-4 | 명확한 실패 | -1 |
| -5 이하 | 대참사 | -2 |
| 크리티컬 | 궁극의 성과 | 1D+6개수 |
| 펌블 | 대참사 | -2 |

---

## 7. 매크로 & 핫바

### 드래그 & 드롭 매크로

다음 아이템을 시트에서 **핫바**로 드래그하면 자동 매크로 생성:

| 아이템 | 매크로 동작 |
|--------|-------------|
| **스킬** | 스킬 발동 (MP 소비) |
| **무기** | 공격 판정 (해당 무기) |
| **아이템** | 아이템 사용 |

### 능력치 판정 매크로

캐릭터 시트의 능력치 주사위 버튼에서도 핫바로 드래그 가능

### 매크로 실행 요건

- 선택된 캐릭터가 있어야 함 (없으면 경고)
- 무기 매크로: 해당 무기가 장착 상태여야 함

---

## 8. GM 도구

### 8.1 컴펜디움

| 팩 | 내용 |
|-----|------|
| **Skills / スキル** | PC 스킬 330개 |
| **Equipment / 装備** | 전체 장비 데이터 |
| **Enemy Skills / エネミースキル** | 에너미 전용 스킬 |

- 첫 로딩 시 자동 생성
- 컴펜디움에서 시트로 **드래그 & 드롭** 가능

### 8.2 에너미 라이브러리

- 에너미 생성 시 자동 표시 (3.1절 참조)
- 41종 에너미 사전 데이터

### 8.3 기습 설정

콘솔 또는 매크로에서:
```javascript
// PC 측 기습
const { setSurprise } = await import("./systems/arianrhod2e/module/helpers/combat-manager.mjs");
await setSurprise(game.combat, "pcs");
```

### 8.4 환경 데미지

```javascript
// 추락 데미지 (2D6 관통)
const { applyEnvironmentalDamage } = await import("./systems/arianrhod2e/module/helpers/combat-manager.mjs");
await applyEnvironmentalDamage(targetActor, 2, "추락 데미지");

// 화염 데미지 (3D6 관통)
await applyEnvironmentalDamage(targetActor, 3, "화염 데미지");
```

### 8.5 토큰 HUD 기능 요약

토큰 클릭 시 HUD 패널에 표시:

| 요소 | 설명 |
|------|------|
| **HP 바** | HP 수치 + 바, ±1/±5 버튼 |
| **MP 바** | MP 수치 + 바, ±1/±5 버튼 |
| **전투 시작** | 퀵 전투 시작 (비전투 시) |
| **전투 참가** | 기존 전투에 합류 |
| **내 턴!** | 현재 턴 표시 |
| **명중 판정** | 공격 롤 |
| **마법 명중** | 마법 공격 롤 |
| **회피 판정** | 회피 롤 |
| **{이름} 공격!** | 대상 토큰에서 바로 공격 |
| **액션 트래커** | M/m/Mv/R 사용 상태 |
| **이동 버튼** | 전투이동/전력이동/이탈/돌입 |
| **엔게이지 배지** | 엔게이지 상태 + 상대 수 |

### 8.6 밝기 & 어둠 시스템

| 단계 | 이름 | 효과 |
|------|------|------|
| 1 | 완전한 어둠 | 어둠 패널티 (-1D), 이동 5m 제한 |
| 2 | 달빛/별빛 | 어둠 패널티 (-1D), 이동 5m 제한 |
| 3 | 아침/저녁 (던전 기본) | 없음 |
| 4 | 한낮 (야외 기본) | 없음 |

**어둠 효과** (단계 1~2):
- 모든 판정에 **-1D 패널티**
- 이동력에 관계없이 **최대 5m**만 이동 가능
- 은신(隠身) 상태가 유리해짐

### 8.7 함정 시스템

함정은 `trap` 아이템 타입으로 생성합니다.

| 필드 | 설명 |
|------|------|
| **함정 레벨** | 함정의 위험도 |
| **구조** | 물리 / 마법 |
| **종류** | 트리거 / 인챈트 / 계속 |
| **탐지 난이도** | 함정 탐지 판정 목표치 |
| **해제 난이도** | 함정 해제 판정 목표치 |
| **저항 판정** | 저항에 사용할 능력치 |
| **저항 난이도** | 저항 판정 목표치 |
| **대상 / 사거리** | 함정 범위 |
| **속성** | 화/수/풍/지/광/암 |
| **데미지** | 피해량 |
| **효과** | 추가 효과 설명 |

> 함정 자동 해결 워크플로우는 현재 미구현입니다 (10절 참조). 함정 데이터를 아이템으로 관리하고 수동으로 판정을 진행하세요.

---

## 9. 기능 검증 체크리스트

### 기본 시스템

| 상태 | 기능 | 테스트 방법 | 기대 결과 |
|------|------|-------------|-----------|
| [ ] | 시스템 로딩 | FVTT에서 월드 접속 | 콘솔에 초기화 메시지, 오류 없음 |
| [ ] | 컴펜디움 자동 생성 | 최초 GM 접속 | 3개 컴펜디움 팩 생성 (스킬/장비/에너미스킬) |
| [ ] | 한국어 UI | 언어 설정: 한국어 | 모든 레이블이 한국어로 표시 |
| [ ] | 설정 7종 | 시스템 설정 메뉴 | 7개 설정 항목 표시, 변경 가능 |

### 캐릭터 시트

| 상태 | 기능 | 테스트 방법 | 기대 결과 |
|------|------|-------------|-----------|
| [ ] | 캐릭터 생성 | 액터 생성 → character | 캐릭터 시트 표시 |
| [ ] | 종족/클래스 선택 | 드롭다운에서 선택 | 능력치 보정 자동 적용 |
| [ ] | 능력치 판정 | 능력치 옆 주사위 버튼 | 2D6+보너스 채팅 롤 |
| [ ] | 특수 판정 | 특수 판정 버튼 클릭 | 해당 능력치로 판정 |
| [ ] | 장비 추가 | 장비 탭 + 버튼 | 장비 선택 다이얼로그 |
| [ ] | 장비 장착/해제 | 슬롯 아이템 클릭 | 장착 토글, 전투 스탯 재계산 |
| [ ] | 스킬 추가 | 스킬 탭 + 버튼 | 스킬 선택 다이얼로그 (330개) |
| [ ] | 스킬 발동 | 스킬 발동 버튼 | MP 차감 + 채팅 메시지 |
| [ ] | 스킬 레벨 증감 | ▲/▼ 버튼 | SL 변경 (1~최대SL) |
| [ ] | 커넥션 추가 | 커넥션 + 버튼 | 커넥션 행 추가 |
| [ ] | D66 관계 롤 | 관계 D66 롤 버튼 | D66 결과 + 관계 자동 선택 |
| [ ] | 성장 로그 | 레벨 올리기 버튼 | 레벨+1, HP/MP 성장 |
| [ ] | 성장점 소모 | 능력치 + 버튼 | 성장점-1, 능력치+1 |
| [ ] | 라이프 패스 | 2D6 롤 버튼 | D66 테이블 결과 |
| [ ] | 내보내기 | 내보내기 버튼 | JSON 다운로드 |
| [ ] | 가져오기 | 가져오기 버튼 | JSON 업로드 → 캐릭터 복원 |
| [ ] | 페이트 사용 | 판정 다이얼로그에서 입력 | 페이트 차감, +nD6 추가 |

### 에너미

| 상태 | 기능 | 테스트 방법 | 기대 결과 |
|------|------|-------------|-----------|
| [ ] | 에너미 생성 다이얼로그 | 액터 생성 → enemy | 에너미 라이브러리 다이얼로그 |
| [ ] | 라이브러리 필터 | 카테고리/타입/레벨 선택 | 필터된 목록 |
| [ ] | 라이브러리 검색 | 검색창 입력 | 실시간 필터 |
| [ ] | 미리보기 | 에너미 선택 | 우측 스탯 미리보기 |
| [ ] | 라이브러리 생성 | "라이브러리에서 생성" 클릭 | 스탯 자동 입력된 에너미 |
| [ ] | 커스텀 생성 | "커스텀 생성" 클릭 | 빈 에너미 시트 |
| [ ] | 에너미 스킬 추가 | 에너미 시트 + 버튼 | 에너미 스킬 선택 다이얼로그 |
| [ ] | 드롭 아이템 | 에너미 격파 (HP=0) | 자동 2D6 드롭 롤 |

### 길드

| 상태 | 기능 | 테스트 방법 | 기대 결과 |
|------|------|-------------|-----------|
| [ ] | 길드 생성 | 액터 생성 → guild | 길드 시트 표시 |
| [ ] | 길드 레벨 | ▲/▼ 버튼 | 1~5 범위 제한 |
| [ ] | 길드 서포트 추가 | + 버튼 | 서포트 선택 다이얼로그 |
| [ ] | 슬롯 제한 | 슬롯 초과 시 | 경고 메시지 |
| [ ] | 중복 방지 | 동일 서포트 재추가 | 경고 메시지 |

### 전투 시스템

| 상태 | 기능 | 테스트 방법 | 기대 결과 |
|------|------|-------------|-----------|
| [ ] | 퀵 전투 시작 | 토큰 HUD "전투 시작" | 선택 토큰 전투 추가, 이니셔티브 자동 |
| [ ] | 전투 참가 | 토큰 HUD "전투 참가" | 기존 전투에 토큰 추가 |
| [ ] | 공격 판정 | 토큰 HUD "명중 판정" | 공격 카드 (회피 버튼 포함) |
| [ ] | 마법 공격 | 토큰 HUD "마법 명중" | INT 기반 공격 카드 |
| [ ] | 회피 판정 | 채팅 카드 "회피 판정" | 명중 결과 카드 (명중/회피) |
| [ ] | 데미지 롤 | 채팅 카드 "데미지 롤" | 데미지 카드 (방어력 차감) |
| [ ] | 데미지 적용 | 채팅 카드 "데미지 적용" | 대상 HP 감소 |
| [ ] | 커버 | 채팅 카드 "커버" | 아군 선택 → 아군에 데미지 |
| [ ] | 페이트 재굴림 | 채팅 카드 "재굴림" | 페이트-1, 새 롤 |
| [ ] | 크리티컬 | 6이 2개+ 나오도록 | 크리티컬 표시, 추가 데미지 다이스 |
| [ ] | 펌블 | 모든 주사위 1 | 펌블 표시, 달성치 0 |
| [ ] | 다중 대상 | Shift+클릭 여러 대상 | 대상별 회피 버튼 |
| [ ] | 리액션측 우선 | 동점 결과 | 방어측 승리 |
| [ ] | 액션 트래커 | 전투 중 토큰 HUD | M/m/Mv/R 표시 |
| [ ] | 전투이동 | HUD "전투이동" | 이동력 m, 채팅 표시 |
| [ ] | 전력이동 | HUD "전력이동" | 이동력×2 m, 마이너 불가 |
| [ ] | 이탈 | HUD "이탈" | 봉쇄 판정 → 성공/실패 |
| [ ] | 돌입 | HUD "돌입" | 대상 선택 → 엔게이지 생성 |
| [ ] | 봉쇄 판정 | 이탈 시 | GM 다이얼로그 → 대항 판정 |
| [ ] | 엔게이지 자동 | 근접 공격 시 | 공격자-대상 엔게이지 자동 |
| [ ] | 엔게이지 배지 | 전투 중 토큰 HUD | 엔게이지 상태 표시 |
| [ ] | 근접 공격 제한 | 미엔게이지 대상 근접 공격 | 경고 메시지 |
| [ ] | 사격 제한 | 같은 엔게이지 대상 사격 | 경고 메시지 |
| [ ] | 상태이상 부여 | 토큰 우클릭 → 상태이상 | 이펙트 추가 |
| [ ] | 상태이상 효과 | 기절 상태에서 회피 | -1D 패널티 |
| [ ] | 독 데미지 | 클린업 페이즈 | 5×n HP 감소 |
| [ ] | 자동 회복 | 클린업 | 격노/방심/넉백 자동 회복 |
| [ ] | 기절 회복 | 이니셔티브 페이즈 | 기절 자동 회복 |
| [ ] | 전투불능 | HP 0 | 전투불능 알림 |
| [ ] | 전투 종료 회복 | 전투 삭제 | HP=0 → HP=1 회복 |
| [ ] | 쿠드그라스 | 전투불능 대상에 선언 | 사망 처리 |
| [ ] | 기습 | 매크로로 설정 | 리액션 -1D |
| [ ] | 셋업 페이즈 | 라운드 시작 | 셋업 스킬 보유자 표시 |
| [ ] | 속성 상성 | 속성 공격 | 방어력 ×0/×1/×2 |
| [ ] | 수면 해제 | 수면 상태에서 데미지 | 수면 자동 해제 |
| [ ] | 환경 데미지 | GM 매크로 | 관통 데미지 적용 |
| [ ] | 전투 가이드 | 전투 시작 시 | 채팅에 가이드 메시지 |

### 매크로 & 기타

| 상태 | 기능 | 테스트 방법 | 기대 결과 |
|------|------|-------------|-----------|
| [ ] | 스킬 매크로 | 스킬 → 핫바 드래그 | 매크로 생성, 클릭 시 발동 |
| [ ] | 무기 매크로 | 무기 → 핫바 드래그 | 매크로 생성, 클릭 시 공격 |
| [ ] | FS 판정 | 매크로 실행 | 달성도 변화 + 프로그레스 바 |
| [ ] | 턴 인디케이터 | 전투 중 턴 변경 | 현재 턴 토큰에 링 표시 |

---

## 10. 미구현 기능 & 로드맵

### 현재 미구현

| 기능 | 설명 | 우선도 |
|------|------|--------|
| **소모품 사용** | 포션/음식 등 아이템 사용 시 효과 자동 적용 | 높음 |
| **휴식 / 회복** | 전투 외 HP/MP 회복 워크플로우 | 높음 |
| **비전투 판정 UI** | 능력치 판정에 대한 난이도 설정 및 성공/실패 판정 | 중간 |
| **레벨업 워크플로우** | 경험치 도달 시 레벨업 안내 및 능력치/스킬 선택 UI | 중간 |
| **함정 해결** | 함정 탐지/해제 판정 자동화 | 중간 |
| **상태이상 자동 적용** | 스킬 효과에 의한 상태이상 자동 부여 | 낮음 |
| **FS 판정 UI** | FS 판정 전용 다이얼로그 | 낮음 |
| **에너미 완전 데이터** | 41종 중 24종의 상세 스탯 추가 | 낮음 |
| **채팅 카드 번역** | 채팅 카드 내 일부 하드코딩 텍스트 i18n 처리 | 낮음 |

---

> 이 가이드는 아리안로드 2E FVTT 시스템 v0.4.0 기준으로 작성되었습니다.
> 문의/버그 리포트: 프로젝트 이슈 트래커를 이용해 주세요.
